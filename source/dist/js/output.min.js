!function(){"use strict";angular.module("app",["ui.router","ui.bootstrap","mwl.calendar","app.routes","app.exception"])}(),function(){"use strict";angular.module("app").controller("AbsenceController",["$scope","$modalInstance","action","event","AbsenceFactory","moment",function(a,b,c,d,e,f){function g(a){var b=angular.copy(a);return"AM"===b.period.toUpperCase()?(b.starts_at=new Date(new Date(b.date).setHours(9,0,0)),b.ends_at=new Date(new Date(b.date).setHours(13,0,0))):"PM"===b.period.toUpperCase()&&(b.starts_at=new Date(new Date(b.date).setHours(13,0,0)),b.ends_at=new Date(new Date(b.date).setHours(18,0,0))),b.editable=!0,b.deletable=!0,b}function h(b){a.validated={name:!0,type:!0,date:!0,period:!0},a.absence="add"===a.action?{}:angular.copy(b)}function i(b){e.checkAvailability(b).then(function(c){c.data.length>0?a.openPanelMessage("Clash detected! You cannot add an absence at this period ["+b.period+"]"):e.insertAbsence(b).then(function(){a.fadeoutMessage("Absence added")})})}function j(b){e.checkAvailability(b).then(function(c){c.data.length>0&&c.data[0]._id!==b._id?a.openPanelMessage("Clash detected! You cannot add an absence at this period ["+b.period+"]"):e.updateAbsence(b).then(function(b){console.log(b),a.fadeoutMessage("Absence updated")})})}function k(){return a.validated.name=void 0===a.absence.name||""===a.absence.name?!1:!0,a.validated.type=void 0===a.absence.type||""===a.absence.type?!1:!0,a.validated.date=void 0===a.absence.date||""===a.absence.date?!1:!0,a.validated.period=void 0===a.absence.period||""===a.absence.period?!1:!0,a.validated.name&&a.validated.type&&a.validated.date&&a.validated.period?!0:!1}function l(){a.showPanelMessage=!1,a.deleteConfirmation=!1,a.validated={name:!0,type:!0,date:!0,period:!0}}h(d),a.action=c,a.showPanelMessage=!1,a.disabled=function(a,b){return"day"===b&&(0===a.getDay()||6===a.getDay())},a.open=function(b){b.preventDefault(),b.stopPropagation(),a.opened=!0},a.dateOptions={formatYear:"yy",startingDay:0,showWeeks:!1,format:"yyyy/MM/dd",minDate:a.minDate?null:new Date},a.submit=function(){if(!k())return!1;var b=g(a.absence);switch(a.action){case"add":i(b);break;case"update":j(b);break;case"delete":a.deleteConfirmation=!0}},a.cancel=function(){b.close(function(){l()})},a.deleteAbsence=function(){e.deleteAbsence(a.absence).then(function(){a.fadeoutMessage("Absence deleted")})},a.cancelDelete=function(){a.deleteConfirmation=!1},a.closeModal=function(){b.close(function(){l(),a.showPanelMessage=!1})},a.openPanelMessage=function(b){a.panelMessage=b,a.showPanelMessage=!0,a.allowBack=!0},a.closePanelMessage=function(){a.showPanelMessage=!1,a.allowBack=!1},a.fadeoutMessage=function(c){a.showPanelMessage=!0,a.panelMessage=c,setTimeout(function(){b.close(function(){l(),a.showPanelMessage=!1})},5e3)},a.formatDate=function(a,b){return f(a).format(b)}}])}(),function(){"use strict";angular.module("app").controller("CalendarController",["$scope","$modal","AbsenceFactory",function(a,b,c){function d(d,e){var f=b.open({templateUrl:"source/partials/absence.html",controller:"AbsenceController",size:"sm",resolve:{action:function(){return d},event:function(){return e}}});f.result.then(function(){"show"!==e&&c.getAbsences().then(function(b){a.events=b.data})},function(){})}a.events=[],c.getAbsences().then(function(b){a.events=b.data}),a.calendarView="month",a.calendarDay=new Date,a.eventClicked=function(a){d("show",a)},a.eventEdited=function(a){d("update",a)},a.eventDeleted=function(a){d("delete",a)},a.addAbsent=function(){d("add",{})},a.setCalendarToToday=function(){a.calendarDay=new Date},a.toggle=function(a,b,c){a.preventDefault(),a.stopPropagation(),c[b]=!c[b]}}])}(),function(){"use strict";angular.module("app").controller("MainController",function(){})}(),function(){"use strict";angular.module("app").controller("TestController",function(){})}(),function(){"use sctrict";angular.module("app.exception",[]).config(["$provide",function(a){a.decorator("$exceptionHandler",["$log","$delegate",function(a,b){return function(c,d){a.debug("Default exception handler."),b(c,d)}}])}])}(),function(){"use strict";angular.module("app").directive("testDirective",function(){return{restrict:"EA",templateUrl:"/source/partials/TestTemplate.html"}})}(),angular.module("app").factory("AbsenceFactory",["$http","moment",function(a,b){var c="/api/absences",d={};return d.getAbsences=function(){return a.get(c)},d.getAbsence=function(b){return a.get(c+"/"+b)},d.insertAbsence=function(b){return a.post(c,b)},d.updateAbsence=function(b){return a.put(c+"/"+b._id,b)},d.deleteAbsence=function(b){return a.delete(c+"/"+b._id)},d.checkAvailability=function(d){return a.get(c+"/filter/availability/"+b(d.date).format("YYYY,MM,DD")+"/"+d.period)},d}]),angular.module("app").factory("UserFactory",["$http",function(a){var b="/api/users",c={};return c.getUsers=function(){return a.get(b)},c.getUser=function(c){return a.get(b+"/"+c)},c.insertUser=function(c){return a.post(b,c)},c.updateUser=function(c){return a.put(b+"/"+c.ID,c)},c.deleteUser=function(c){return a.delete(b+"/"+c)},c}]),function(){"use strict";angular.module("app.routes",["ngRoute","ui.router"]).config(["$routeProvider","$stateProvider",function(a,b){a.otherwise({redirectTo:""}),b.state("main",{url:"",templateUrl:"source/partials/calendar.html",controller:"CalendarController"}).state("calendar",{url:"/calendar",templateUrl:"source/partials/calendar.html",controller:"CalendarController"}).state("map",{url:"/map",templateUrl:"source/partials/TestTemplate.html",controller:"TestController"})}])}(),function(){"use strict";angular.module("app").service("testService",function(){})}();